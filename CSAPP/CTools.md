# C 语言工具链

这里包含在进行 CSAPP 实验时，会用到的一些 C 语言的工具链，包括 GCC，GDB，make等等。

## 1. GDB

### 前置知识：

- 告诉编译器编译时包含调试信息

    ``` shell
    gcc -Og -g hello.c -o hello // -Og 对调试无影响的优化
    g++ -g hello.cpp -o hello
    ```

- 开启 gui 界面进行调试

    ```shell
    gdb <可执行文件名称> -tui
    ```

- 运行代码

    ```shell
    (gdb) run/r arg1 arg2 ...
    ```

### 调试：

#### 窗口

- `info win`：查看 tui 界面的焦点
- `fs next`：转移焦点

#### 查看寄存器或者汇编窗口

- `layout src`：标准显示：上方源码，下方命令行
- `layout asm`：上方汇编，下方命令行
- `layout split`：上：源码、中：汇编、下：命令行
- `layout reg`：上：寄存器的值，下：命令行
- `tui reg general`：显示通用寄存器
- `tui reg float`：显示浮点寄存器
- `tui reg system`：显示系统寄存器
- `tui reg next`：下一个寄存器集合

#### 设置断点

可以在下面表达式之后添加 if 判断

- `(gdb) break <函数名>`：对当前正在执行的文件中的指定函数设置断点。可简写为：(gdb) b <函数名>
- `(gdb) break <行号>`：对当前正在执行的文件中的特定行设置断点。可简写为：(gdb) b <行号>
- `(gdb) break <文件名：行号>`：对指定文件的指定行设置断点。最常用的设置断点方式。可简写为：(gdb) b <文件名：行号>
- `(gdb) break <文件名：函数名>`：对指定文件的指定函数设置断点。C++类中的方法似乎不好使。可简写为：(gdb) b <文件名：函数名>
- `(gdb) break <+/-偏移量>`：当前指令行+/-偏移量出设置断点。可简写为：b <+/-偏移量>
- `(gdb) break <*地址>`：指定地址处设置断点。可简写为：b <*地址>

- `continue/c`：执行到下一个断点
- `clear num`：删除指定的断点

#### 打印值：

- `p/print *pointer@length`：打印指针的值

- `x/<n/f/u>  \<addr\> `：“x/”后的n、f、u都是可选的参数，n 是一个正整数，表示显示内存的长度，也就是说从当前地址向后显示几个地址的内容；f 表示显示的格式，如果地址所指的是字符串，那么格式可以是s，如果地址是指令地址，那么格式可以是i；u 表示从当前地址往后请求的字节数，如果不指定的话，GDB默认是4字节。u参数可以被一些字符代替：b表示单字节，h表示双字节，w表示四字节，g表示八字节。当我们指定了字节长度后，GDB会从指定的内存地址开始，读写指定字节，并把其当作一个值取出来。n、f、u这3个参数可以一起使用，例如命令“x/3uh 0x54320”表示从内存地址0x54320开始以双字节为1个单位（h）、16进制方式（u）显示3个单位（3）的内存。

| 格式 | 说明                                        |
| ---- | ------------------------------------------- |
| x    | 显示为十六进制数                            |
| d    | 显示为十进制数                              |
| u    | 显示位为符号十进制数                        |
| o    | 显示为八进制数                              |
| t    | 显示为二进制数                              |
| a    | 显示为地址                                  |
| c    | 显示为字符（ASCII）                         |
| f    | 显示为浮点数                                |
| s    | 显示为字符串                                |
| i    | 显示为机器语言（仅在显示内存的x命令中可用） |

- `display <变量>`：展示变量的值
- `watch <变量>`：观察变量的变化

#### 栈信息

- `(gdb) bt`：显示所有栈帧
- `(gdb) bt 10`：显示前面10个栈帧
- `(gdb) bt -10`：显示后面10个栈帧
- `(gdb) bt full`：显示栈帧以及局部变量
- `(gdb) bt full 10`：显示前面10个栈帧以及局部变量
- `(gdb) bt full -10`：显示后面10个栈帧以及局部变量
- `(gdb) frame <栈帧编号>`：进入指定的栈帧中，然后可以查看当前栈帧中的局部变量，以及栈帧内容等信息
- `(gdb) info frame <栈帧编号>`：可以查看指定栈帧的详细信息
- `(gdb) up`：进入上层栈帧
- `(gdb) down`：进入下层栈帧

![git-cheat-sheet](https://raw.githubusercontent.com/charming-c/image-host/master/img/git-cheat-sheet.webp)