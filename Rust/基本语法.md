# Rust 语言基本语法

## 一、基本计算

### 1. 整型数据 Integer

像其他大多数语言一样，Rust 也分为有符号（signed）和无符号（unsigned）整数。

**位宽（bit width）**：rust 将整型数据分成了不同的位宽，大致如下:

| Bit width | Signed | Unsigned |
| :-------: | :----: | :------: |
|   8-bit   |  `i8`  |   `u8`   |
|  16-bit   | `i16`  |  `u16`   |
|  32-bit   | `i32`  |  `u32`   |
|  64-bit   | `i64`  |  `u64`   |
|  128-bit  | `i128` |  `u128`  |

> **显式数字**：在没有提供上下文的情况下，Rust 编译器默认将显式数字赋值的变量类型设置为 `i32`， 如果想要使用不同的类型，需要在数字后指定。
>
> ```rust
> let a = 42
> // a 是 类型为 i32 的变量，值为 42
> let b = 42u32
> // b 是 类型为 i32 的变量，值为 42
> ```
>
> **下划线使用**：在表示大数是，可以在数字中使用 下划线 _ 分割数字

**没有自动强制类型转换**：Rust 是静态类型语言，但是不像 Java 没有自动的强制类型转换。也就是说，以下的操作是不被编译器所接受的：

```rust
let b: u8 = 100;
let a: u32 = b;
// 由于没有自动的强制类型转换，所以无法将 u8 类型的变量 b 赋值给 u32 类型的 a
```

### 2. 变量 Variables

在 rust 中使用 let 关键字声明变量。可以使用如下的语法，指明变量类型和值：

```rust
// let <variable_name>: <type> = <expression>;
let x: u32 = 42;
```

如果没有明确指明变量的类型，编译器会基于上下文尝试推断变量的类型：

```rust
let x = 42;
let y: u32 = x;
// 这里的 x 在下文中被赋值给 y，所以这里的 x 就不是默认的 i32 类型了，而是 u32
```

**函数的参数也是变量**：并不是所有的变量都是由 let 声明，函数的参数也是变量：

```rust
fn add_one(x: u32) -> u32 {
    x + 1
}
// 这里的 x 是一个 u32 类型的变量
```

变量在使用之前必须初始化。

**mut 关键字：**

在 Rust 中，变量默认赋值后是不能修改的，如果想要变量是可以修改的，则需要使用到 mut 关键字：

```rust
// `sum` and `i` are mutable now!
let mut sum = 0;
let mut i = 1;

while i <= 5 {
    sum += i;
    i += 1;
}
// i 如果是在 for 中是可以进行 mut 声明的
```



### 3. 分支语法（if/else）

**在 Rust 中 if 语句 不是语句而是表达式，是有返回值的！**语法示例：

```rust
let number = 3;
let message = if number < 5 {
    "smaller than 5"
} else {
    "greater than or equal to 5"
};
```

### 4. panic! 宏

当出现一些错误的时候，可以调用panic！直接终止程序执行。

```rust
fn main() {
    panic!("This is a panic!");
    // The line below will never be executed
    let x = 1 + 2;
}
```

### 5. 循环语句（while/for）

while 语法/ for 语法：

``` rust
while <condition> {
    // code to execute
}

for <element> in <iterator> {
    // code to execute
}
// 其中的 element/condition 和 if 一样 是不用括号的
```

Rust 中范围有一下几种形式：

- `1..5`: 半开区间，不包括 5
- `1..=5`: 闭区间，包括 5
- `1..`: 表示 从 1 到 无穷大的数字
- `..5`: 从最小值到 4
- `..=5`: 从最小值到 5

> 针对溢出，Rust 有两种形式：overflow-checks
>
> - 溢出检查设置为 true，则在溢出时会 panic
>
> - 溢出检查设置为 false，则会溢出包装，也就是整个值域是一个环，会溢出到最前面
>
> Rust 有两种环境，一个是 dev 开发环境，一个是 release 发布环境，dev 默认 overflow-check 为 true， release 默认为 false，可以在 Cargo 配置文件中修改 profile 选项
>
> **`saturating_ methods`**：可以限制溢出，锁定在边界值，不过在使用这个方法时要指明变量类型

**`as`关键字**：可以使用 `as`运算符进行 integer 之间的类型转换，这种转换是健壮的，在向下转换时会进行截断。

```rust
// A number that's too big 
// to fit into a `u8`
let a: u16 = 255 + 1;
let b = a as u8;
// 这里的 b 会是 0
```

> 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0
>|                       |                        |
>+---------------+---------------+
>  First 8 bits          Last 8 bits