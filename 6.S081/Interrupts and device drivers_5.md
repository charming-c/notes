# Interrupts and device drivers

## 1. 设备驱动	

驱动（driver）是指操作系统用来管理设备的代码：它配置了硬件设备，告诉设备去执行操作，处理中断结果，并且和可能在等待设备 I/O 的进程交互。驱动代码可以很难搞（晦涩），因为一个驱动和他所管理的设备会并行执行。还有，驱动必须理解设备的硬件接口，这通常是很复杂，并且缺少文档。

​	当设备需要 OS 的注意是，通常会表现为生成一个中断，trap 的一种。内核的 trap 处理代码会识别出设备的中断，并且调用设备的中断 handler。在 xv86 中，这种分法识别在 devintr 中。

许多中断代码执行在两个上下文中：

- 上半部分执行在进程的内核线程
- 下半部分在中断的时间执行

上半部分通过系统调用，比如 read、write这些想要设备执行 I/O 操作的。这些代码可能会请求硬件去开始一个操作（例如，请求磁盘读一个 block），然后代码等待操作执行完毕。最终设备完成操作后，会发起一个 interrupt。驱动的 interrupt handler，在下半部分执行，明确什么操作完成了，唤醒等待的线程（正确的等待的），并且告诉硬件继续开始等待下一个操作。

## 2. 时钟中断

一般用来作业调度，防止一个进程抢占 CPU 太久。

